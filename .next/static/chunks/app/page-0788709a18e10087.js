(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{67:function(){},2061:function(){},952:function(e,t,s){Promise.resolve().then(s.bind(s,9263))},9263:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var i=s(7437),r=s(2265),a=s(7800);function l(e){let{onData:t,onError:s}=e,l=(0,r.useRef)(null),n=async e=>{var i;if(!e||0===e.length)return;let r=e[0],l=null===(i=r.name.split(".").pop())||void 0===i?void 0:i.toLowerCase();if("xlsx"!==l&&"csv"!==l){s("Only .xlsx or .csv files are supported."),t([]);return}try{let e;let i=await r.arrayBuffer(),n=e=>e.replace(/\s+/g,"").toLowerCase(),c=["pk","coins","action"],o={pk:["pk","id","userid","user_id","sk"],coins:["coins","coin","amount","value"],action:["action","type","event","actiontype"]};if("csv"===l){let t=new TextDecoder().decode(i).split(/\r?\n/).filter(Boolean),s=t[0].split(",").map(e=>e.trim()),r={};if(s.forEach((e,t)=>{r[n(e)]=t}),!c.every(e=>o[e].some(e=>void 0!==r[n(e)])))throw Error("Missing required fields: pk/sk, coins, action");e=t.slice(1).map(e=>{var t,s,i;let a=e.split(","),l=o.pk.find(e=>void 0!==r[n(e)])||"pk",c=o.coins.find(e=>void 0!==r[n(e)])||"coins",d=o.action.find(e=>void 0!==r[n(e)])||"action";return{pk:null===(t=a[r[n(l)]])||void 0===t?void 0:t.trim(),coins:null===(s=a[r[n(c)]])||void 0===s?void 0:s.trim(),action:null===(i=a[r[n(d)]])||void 0===i?void 0:i.trim()}})}else{let t=a.ij(i,{type:"array"}),s=t.Sheets[t.SheetNames[0]];if(!((e=a.P6.sheet_to_json(s,{defval:""}).map(e=>{var t,s,i;let r=Object.keys(e),a={};return r.forEach(t=>{let s=n(t);for(let i of c)if(o[i].includes(s)){a[i]=e[t];break}}),{pk:null!==(t=a.pk)&&void 0!==t?t:"",coins:null!==(s=a.coins)&&void 0!==s?s:"",action:null!==(i=a.action)&&void 0!==i?i:""}})).length>0&&c.every(t=>Object.keys(e[0]||{}).some(e=>o[t].includes(n(e))))))throw Error("Missing required fields: pk/sk, coins, action")}if(e.some(e=>!e.pk||!e.coins||!e.action))throw Error("Missing required fields: pk, coins, action");e=e.map(e=>({...e,coins:Number(e.coins),pk:String(e.pk),action:String(e.action)})),s(null),t(e)}catch(e){s(e.message||"Failed to parse file."),t([])}};return(0,i.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 flex flex-col items-center justify-center bg-white hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>{var e;return null===(e=l.current)||void 0===e?void 0:e.click()},onDrop:e=>{e.preventDefault(),n(e.dataTransfer.files)},onDragOver:e=>e.preventDefault(),tabIndex:0,role:"button","aria-label":"Upload file",children:[(0,i.jsx)("input",{ref:l,type:"file",accept:".xlsx,.csv",className:"hidden",onChange:e=>{n(e.target.files)}}),(0,i.jsx)("span",{className:"text-lg font-medium text-gray-700 mb-2",children:"Drag & drop or click to upload"}),(0,i.jsx)("span",{className:"text-gray-500 text-sm",children:"Accepted: .xlsx, .csv"})]})}var n=s(4839),c=s(6164);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,c.m6)((0,n.W)(t))}let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:o("rounded-xl border bg-card text-card-foreground shadow",s),...r})});d.displayName="Card",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:o("flex flex-col space-y-1.5 p-6",s),...r})}).displayName="CardHeader",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:o("font-semibold leading-none tracking-tight",s),...r})}).displayName="CardTitle",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:o("text-sm text-muted-foreground",s),...r})}).displayName="CardDescription",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:o("p-6 pt-0",s),...r})}).displayName="CardContent",r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,i.jsx)("div",{ref:t,className:o("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter";let h={redeem_bonus:"Welcome Bonus",buy_gift:"Gift Sent",grant_widget_bonus:"Poll Vote"},x=e=>h[e]||e;function m(e){let{data:t}=e,s=new Set(t.map(e=>e.pk)).size,r=t.reduce((e,t)=>e+(Number(t.coins)||0),0),a={};t.forEach(e=>{a[e.action]||(a[e.action]=[]),a[e.action].push(e)});let l=Object.entries(a).map(e=>{let[t,s]=e,i=new Set(s.map(e=>e.pk)).size,r=s.reduce((e,t)=>e+(Number(t.coins)||0),0);return{action:t,uniqueUsers:i,totalCoins:r,totalRows:s.length,avgCoinsPerUser:i>0?Math.round(r/i*100)/100:0}}).sort((e,t)=>t.totalCoins-e.totalCoins);return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[(0,i.jsxs)(d,{className:"p-6 rounded-xl shadow bg-white flex flex-col items-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:s.toLocaleString()}),(0,i.jsx)("div",{className:"text-gray-600 mt-1",children:"Unique Users"})]}),(0,i.jsxs)(d,{className:"p-6 rounded-xl shadow bg-white flex flex-col items-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:(s>0?Math.round(r/s*100)/100:0).toLocaleString()}),(0,i.jsx)("div",{className:"text-gray-600 mt-1",children:"Avg. Coins/User"})]}),(0,i.jsxs)(d,{className:"p-6 rounded-xl shadow bg-white flex flex-col items-center",children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:r.toLocaleString()}),(0,i.jsx)("div",{className:"text-gray-600 mt-1",children:"Total Coins"})]})]}),(0,i.jsxs)(d,{className:"p-6 rounded-xl shadow bg-white",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Action Breakdown"}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left py-2",children:"Action"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Unique Users"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Total Coins"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Avg. Coins/User"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Transactions"})]})}),(0,i.jsx)("tbody",{children:l.map(e=>(0,i.jsxs)("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"py-2",children:x(e.action)}),(0,i.jsx)("td",{className:"text-right py-2",children:e.uniqueUsers.toLocaleString()}),(0,i.jsx)("td",{className:"text-right py-2",children:e.totalCoins.toLocaleString()}),(0,i.jsx)("td",{className:"text-right py-2",children:e.avgCoinsPerUser.toLocaleString()}),(0,i.jsx)("td",{className:"text-right py-2",children:e.totalRows.toLocaleString()})]},e.action))})]})})]})]})}var p=s(8875),g=s(7886),u=s(9810),f=s(8295),j=s(4741),N=s(7028);let y={redeem_bonus:"Welcome Bonus",buy_gift:"Gift Sent",grant_widget_bonus:"Poll Vote"},b=e=>y[e]||e,v=["#6366f1","#22d3ee","#f59e42","#f43f5e","#a3e635","#eab308","#f472b6","#7c3aed","#10b981","#f87171"];function q(e){let{data:t}=e,s=new Map;t.forEach(e=>{s.set(e.action,(s.get(e.action)||0)+(Number(e.coins)||0))});let r=Array.from(s.entries()).map(e=>{let[t,s]=e;return{action:t,actionName:b(t),coins:s}});return 0===r.length?null:(0,i.jsxs)("div",{className:"bg-white rounded-xl shadow p-6",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4 text-center",children:"Coin Distribution by Action"}),(0,i.jsx)(p.h,{width:"100%",height:300,children:(0,i.jsxs)(g.u,{children:[(0,i.jsx)(u.b,{data:r,dataKey:"coins",nameKey:"actionName",cx:"50%",cy:"50%",outerRadius:100,fill:"#6366f1",label:e=>{let{name:t,percent:s}=e;return"".concat(t,": ").concat((100*s).toFixed(0),"%")},children:r.map((e,t)=>(0,i.jsx)(f.b,{fill:v[t%v.length]},"cell-".concat(t)))}),(0,i.jsx)(j.u,{formatter:e=>e.toLocaleString()}),(0,i.jsx)(N.D,{})]})})]})}function S(e){let{data:t}=e,s=new Map;t.forEach(e=>{let t=e.pk,i=Number(e.coins)||0;s.set(t,(s.get(t)||0)+i)});let r=t.reduce((e,t)=>e+(Number(t.coins)||0),0),a=Array.from(s.entries()).map(e=>{let[t,s]=e;return{userId:t,coins:s}});a.sort((e,t)=>e.coins-t.coins);let l=0,n={p25:0,p50:0,p70:0,p90:0};for(let e of a){let t=(l+=e.coins)/r*100;0===n.p25&&t>=25&&(n.p25=e.coins),0===n.p50&&t>=50&&(n.p50=e.coins),0===n.p70&&t>=70&&(n.p70=e.coins),0===n.p90&&t>=90&&(n.p90=e.coins)}let c={q1:{min:0,max:n.p25},q2:{min:n.p25,max:n.p50},q3:{min:n.p50,max:n.p70},q4:{min:n.p70,max:n.p90},q5:{min:n.p90,max:Math.max(...a.map(e=>e.coins))}};n.p25===n.p50&&(c.q2.min=n.p25,c.q2.max=n.p25),n.p50===n.p70&&(c.q3.min=n.p50,c.q3.max=n.p50),n.p70===n.p90&&(c.q4.min=n.p70,c.q4.max=n.p70);let o={q1:a.filter(e=>e.coins<=n.p25),q2:a.filter(e=>e.coins>n.p25&&e.coins<=n.p50),q3:a.filter(e=>e.coins>n.p50&&e.coins<=n.p70),q4:a.filter(e=>e.coins>n.p70&&e.coins<=n.p90),q5:a.filter(e=>e.coins>n.p90)},h={q1:o.q1.length,q2:o.q2.length,q3:o.q3.length,q4:o.q4.length,q5:o.q5.length},x={q1:o.q1.reduce((e,t)=>e+t.coins,0),q2:o.q2.reduce((e,t)=>e+t.coins,0),q3:o.q3.reduce((e,t)=>e+t.coins,0),q4:o.q4.reduce((e,t)=>e+t.coins,0),q5:o.q5.reduce((e,t)=>e+t.coins,0)},m={p25:n.p25,p50:n.p50,p70:n.p70,p90:n.p90};return(0,i.jsxs)(d,{className:"p-6 rounded-xl shadow bg-white",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"User Coin Distribution"}),(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-md font-medium mb-2",children:"Coin Quantile Cutoffs (By Total Coin Value)"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"25% of Total Coins"}),(0,i.jsxs)("div",{className:"text-lg font-medium",children:["≤ ",m.p25.toLocaleString()," coins"]})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"50% of Total Coins"}),(0,i.jsxs)("div",{className:"text-lg font-medium",children:["≤ ",m.p50.toLocaleString()," coins"]})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"70% of Total Coins"}),(0,i.jsxs)("div",{className:"text-lg font-medium",children:["≤ ",m.p70.toLocaleString()," coins"]})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-sm text-gray-500",children:"90% of Total Coins"}),(0,i.jsxs)("div",{className:"text-lg font-medium",children:["≤ ",m.p90.toLocaleString()," coins"]})]})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-md font-medium mb-2",children:"User Distribution by Coin Value Quantile"}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{className:"border-b",children:[(0,i.jsx)("th",{className:"text-left py-2",children:"Quantile"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Coin Range"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Users"}),(0,i.jsx)("th",{className:"text-right py-2",children:"% of Users"}),(0,i.jsx)("th",{className:"text-right py-2",children:"Total Coins"}),(0,i.jsx)("th",{className:"text-right py-2",children:"% of Coins"})]})}),(0,i.jsxs)("tbody",{children:[(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"py-2",children:"0-25%"}),(0,i.jsxs)("td",{className:"text-right py-2",children:[c.q1.min.toLocaleString(),"-",c.q1.max.toLocaleString()]}),(0,i.jsx)("td",{className:"text-right py-2",children:h.q1.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(h.q1/a.length*100),"%"]}),(0,i.jsx)("td",{className:"text-right py-2",children:x.q1.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(x.q1/t.reduce((e,t)=>e+(Number(t.coins)||0),0)*100),"%"]})]}),(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"py-2",children:"25-50%"}),(0,i.jsx)("td",{className:"text-right py-2",children:c.q2.min===c.q2.max?c.q2.min.toLocaleString():"".concat((c.q2.min+.01).toLocaleString(),"-").concat(c.q2.max.toLocaleString())}),(0,i.jsx)("td",{className:"text-right py-2",children:h.q2.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(h.q2/a.length*100),"%"]}),(0,i.jsx)("td",{className:"text-right py-2",children:x.q2.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(x.q2/t.reduce((e,t)=>e+(Number(t.coins)||0),0)*100),"%"]})]}),(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"py-2",children:"50-70%"}),(0,i.jsx)("td",{className:"text-right py-2",children:c.q3.min===c.q3.max?c.q3.min.toLocaleString():"".concat((c.q3.min+.01).toLocaleString(),"-").concat(c.q3.max.toLocaleString())}),(0,i.jsx)("td",{className:"text-right py-2",children:h.q3.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(h.q3/a.length*100),"%"]}),(0,i.jsx)("td",{className:"text-right py-2",children:x.q3.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(x.q3/t.reduce((e,t)=>e+(Number(t.coins)||0),0)*100),"%"]})]}),(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"py-2",children:"70-90%"}),(0,i.jsx)("td",{className:"text-right py-2",children:c.q4.min===c.q4.max?c.q4.min.toLocaleString():"".concat((c.q4.min+.01).toLocaleString(),"-").concat(c.q4.max.toLocaleString())}),(0,i.jsx)("td",{className:"text-right py-2",children:h.q4.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(h.q4/a.length*100),"%"]}),(0,i.jsx)("td",{className:"text-right py-2",children:x.q4.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(x.q4/t.reduce((e,t)=>e+(Number(t.coins)||0),0)*100),"%"]})]}),(0,i.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[(0,i.jsx)("td",{className:"py-2",children:"90-100%"}),(0,i.jsxs)("td",{className:"text-right py-2",children:["> ",c.q5.min.toLocaleString()]}),(0,i.jsx)("td",{className:"text-right py-2",children:h.q5.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(h.q5/a.length*100),"%"]}),(0,i.jsx)("td",{className:"text-right py-2",children:x.q5.toLocaleString()}),(0,i.jsxs)("td",{className:"text-right py-2",children:[Math.round(x.q5/t.reduce((e,t)=>e+(Number(t.coins)||0),0)*100),"%"]})]})]})]})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-md font-medium mb-2",children:"Key Insights"}),(0,i.jsxs)("ul",{className:"list-disc pl-5 space-y-1 text-sm",children:[(0,i.jsxs)("li",{children:["Users with ≤ ",m.p25.toLocaleString()," coins hold 25% of all coins"]}),(0,i.jsxs)("li",{children:["Users with ≤ ",m.p50.toLocaleString()," coins hold 50% of all coins"]}),(0,i.jsxs)("li",{children:["Users with ≤ ",m.p70.toLocaleString()," coins hold 70% of all coins"]}),(0,i.jsxs)("li",{children:["Users with ≤ ",m.p90.toLocaleString()," coins hold 90% of all coins"]}),(0,i.jsxs)("li",{children:["Users with > ",m.p90.toLocaleString()," coins hold 10% of all coins"]}),(0,i.jsxs)("li",{children:[h.q5.toLocaleString()," users (",Math.round(h.q5/a.length*100),"% of users) hold 10% of all coins"]})]})]})]})]})}function w(){let[e,t]=(0,r.useState)([]),[s,a]=(0,r.useState)(null);return(0,i.jsxs)("main",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-8 text-center",children:"CoinsDash"}),(0,i.jsx)(l,{onData:t,onError:a}),s&&(0,i.jsx)("div",{className:"mt-4 text-red-600 bg-red-100 p-3 rounded",children:s}),e.length>0&&!s&&(0,i.jsxs)("div",{className:"mt-8 grid gap-6",children:[(0,i.jsx)(m,{data:e}),(0,i.jsx)(q,{data:e}),(0,i.jsx)(S,{data:e})]})]})}}},function(e){e.O(0,[425,113,971,23,744],function(){return e(e.s=952)}),_N_E=e.O()}]);